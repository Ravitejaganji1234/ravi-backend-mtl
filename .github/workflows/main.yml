name: Deploy Spring Boot Application to Azure App Service
 
on:
  push:
    branches:
      - main  # You can change this to your preferred branch
 
jobs:
  build-and-deploy:
    runs-on: windows-latest
 
    steps:
    # Step 1: Checkout the code
    - name: Checkout Code
      uses: actions/checkout@v3
 
    # Step 2: Set up Java JDK (Make sure to use the correct version you need)
    - name: Set up Java JDK 17
      uses: actions/setup-java@v3
      with:
        java-version: '17'  # Use Java 17 (or adjust if you're using a different version)
        distribution: 'adoptopenjdk'
 
    # Step 3: Build the Spring Boot application (use Maven or Gradle)
    - name: Build with Maven
      run: |
        mvn clean install -DskipTests  # If using Maven
 
    # Step 4: Deploy to Azure Web App using the publish profile
    - name: Deploy to Azure Web App
      uses: azure/webapps-deploy@v2
      with:
        app-name: 'mtlbackend'  # Replace with your Azure Web App name
        publish-profile: ${{ secrets.AZURE_WEBAPP_PUBLISH_PROFILE }}  # Azure publish profile as secret
        package: ./target/*.jar  # Path to the generated JAR file (or WAR file if applicable)
